{
  "unit_id": "product.engine.build.v1",
  "title": "Build & Seal Engine Product (fixed policies)",
  "required_fields": [
    "product.name",
    "product.version",
    "product.components"
  ],
  "effects": {
    "read": [],
    "write": [
      "fs://registry/*",
      "fs://audit/*"
    ],
    "network": [],
    "filesystem": [],
    "process": [],
    "wasm": []
  },
  "policies": [
    {
      "id": "engine.auth.role.v1",
      "title": "Actor must be allowed role",
      "condition": {
        "fn": "in_set",
        "args": [
          {
            "ref": [
              "actor",
              "role"
            ]
          },
          [
            "admin",
            "pm",
            "release_mgr"
          ]
        ]
      }
    },
    {
      "id": "engine.required.components_nonempty.v1",
      "title": "At least one component",
      "condition": {
        "fn": "gte",
        "args": [
          {
            "fn": "array_len",
            "args": [
              {
                "ref": [
                  "product",
                  "components"
                ]
              }
            ]
          },
          1
        ]
      }
    },
    {
      "id": "engine.version.semver_like.v1",
      "title": "Semver-like version",
      "condition": {
        "fn": "matches",
        "args": [
          {
            "ref": [
              "product",
              "version"
            ]
          },
          "^[0-9]+\\.[0-9]+\\.[0-9]+([+-].*)?$"
        ]
      }
    }
  ],
  "output": {
    "echo": {
      "manifest": {
        "ref": [
          "product"
        ]
      }
    },
    "derive_did_from_echo": true
  }
}